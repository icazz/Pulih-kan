import{c as D,m as j,p as M,a as o,b as v,d as e,u,h as S,w as z,f as g,l as C,t as l,e as x,n as L,F as k,i as y,q as A,g as h,s as K,v as T,o as s}from"./app-CqGoo8t5.js";import{L as b,i as I,a as P}from"./marker-shadow-B0ynlELw.js";const V={class:"h-screen w-full flex flex-col md:flex-row overflow-hidden bg-white"},R={class:"w-full md:w-1/2 h-1/2 md:h-full relative bg-gray-100 order-2 md:order-1"},F={class:"w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-white border-l border-gray-200 order-1 md:order-2 shadow-2xl z-10"},$={class:"bg-[#28160A] p-8 text-white flex-shrink-0"},N={class:"text-white/70 mt-1"},U={class:"mt-4 inline-block px-3 py-1 rounded bg-white/10 border border-white/20 text-xs font-mono"},E={class:"flex-1 overflow-y-auto p-8 space-y-8"},O={class:"space-y-6"},J={class:"text-xl font-bold text-gray-900 leading-tight"},q={class:"text-gray-700"},H={class:"bg-gray-50 p-6 rounded-2xl border border-gray-100"},G={class:"text-gray-800 leading-relaxed"},Q={class:"grid grid-cols-2 gap-6"},W={class:"font-bold text-lg"},X={key:0,class:"p-4 bg-green-50 rounded-xl border border-green-100"},Y={class:"font-bold text-lg text-green-700"},Z={key:0,class:"grid grid-cols-3 gap-2"},_=["href"],ee=["src"],te={key:1,class:"w-full h-full bg-black flex items-center justify-center text-white group-hover:bg-gray-900 transition"},re={key:1,class:"w-full p-4 bg-gray-50 rounded-xl border border-gray-200 text-center"},oe=["href"],se={key:1,class:"block w-full p-4 bg-gray-50 rounded-xl border border-gray-200 cursor-not-allowed opacity-70"},le=["href"],ae={key:1,class:"block w-full p-4 bg-gray-50 rounded-xl border border-gray-200 cursor-not-allowed opacity-70"},ne={class:"flex flex-wrap gap-2"},ie={key:0,class:"text-gray-400 italic text-sm"},de={key:0,class:"bg-gradient-to-r from-orange-50 to-white p-5 rounded-2xl border border-orange-200 shadow-sm relative overflow-hidden"},ue={class:"flex items-start gap-4 relative z-10"},pe={class:"w-12 h-12 rounded-full bg-[#BB4D00] text-white flex items-center justify-center font-bold text-xl shadow-md"},be={class:"flex-1"},ce={class:"text-lg font-bold text-gray-900 leading-tight"},ge={class:"text-sm text-gray-600 mt-1 flex flex-col gap-1"},xe={class:"flex items-center gap-2"},fe={class:"flex items-center gap-2"},ke={class:"truncate max-w-[200px]"},me={class:"pt-8 border-t border-gray-100"},ve={key:0,class:"bg-orange-50 p-6 rounded-2xl border border-orange-200"},ye={class:"grid grid-cols-2 gap-4 mb-6"},he={class:"flex gap-3"},we=["disabled"],Be={key:1,class:"bg-blue-50 p-6 rounded-2xl border border-blue-200 text-center"},De={class:"text-2xl font-black text-blue-600 mb-6"},je={key:2,class:"bg-green-50 p-6 rounded-2xl border border-green-200 text-center"},Me={class:"text-xl font-bold text-green-700 mb-4"},Se={key:3,class:"text-center p-6 bg-gray-50 border border-gray-200 rounded-xl text-gray-500"},ze={key:0,class:"font-bold text-lg mb-2 text-gray-700"},Ae={__name:"ReportDetail",props:{report:Object,auth:Object},setup(r){let w=b.icon({iconUrl:P,shadowUrl:I,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});b.Marker.prototype.options.icon=w;const n=r,m=D(()=>{if(!n.report.evidence_files)return[];if(Array.isArray(n.report.evidence_files))return n.report.evidence_files;try{return JSON.parse(n.report.evidence_files)}catch{return[]}}),B=d=>d.match(/\.(jpeg|jpg|gif|png|webp|bmp)$/i),i=j({action:"",price:n.report.price?parseInt(n.report.price):"",category:n.report.category||""});M(()=>{const d=parseFloat(n.report.latitude)||-6.175392,t=parseFloat(n.report.longitude)||106.827153,p=b.map("detailMap").setView([d,t],15);b.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(p),b.marker([d,t]).addTo(p).bindPopup(n.report.location).openPopup()});const c=d=>{if(!confirm("Apakah Anda yakin?"))return;i.action=d;let t="";d==="verify"?t=route("admin.reports.update",n.report.id):t=route("admin.updateStatus",n.report.id),i.patch(t,{preserveScroll:!0,preserveState:!1,onSuccess:()=>{alert("Berhasil diperbarui!")},onError:p=>{console.error(p),alert("Gagal: "+JSON.stringify(p))}})};return(d,t)=>{var p;return s(),o(k,null,[v(u(S),{title:`Detail Laporan #${r.report.id}`},null,8,["title"]),e("div",V,[e("div",R,[t[7]||(t[7]=e("div",{id:"detailMap",class:"w-full h-full z-0"},null,-1)),v(u(C),{href:d.route("admin.dashboard"),class:"absolute top-6 left-6 z-[400] bg-white text-gray-800 px-4 py-2 rounded-full shadow-lg font-bold flex items-center gap-2 hover:bg-gray-50 transition"},{default:z(()=>[...t[6]||(t[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),g(" Kembali ke Dashboard ",-1)])]),_:1},8,["href"])]),e("div",F,[e("div",$,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold"},"Detail Pengajuan",-1)),e("p",N,"ID: REQ-"+l(r.report.id)+" â€¢ Client: "+l(r.report.user?r.report.user.name:"User"),1),e("div",U," Status: "+l(r.report.status.toUpperCase()),1)]),e("div",E,[e("div",O,[e("div",null,[t[9]||(t[9]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-1"},"Judul Laporan",-1)),e("p",J,l(r.report.title),1)]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-1"},"Lokasi",-1)),e("p",q,l(r.report.location),1)]),e("div",H,[t[11]||(t[11]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-2"},"Deskripsi Masalah",-1)),e("p",G,l(r.report.description),1)]),e("div",Q,[e("div",{class:L(["p-4 bg-gray-50 rounded-xl border border-gray-100",{"col-span-2":r.report.status==="process"||r.report.status==="completed"}])},[t[12]||(t[12]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-1"},"Luas Area",-1)),e("p",W,l(r.report.house_size||"-"),1)],2),r.report.status!=="process"&&r.report.status!=="completed"?(s(),o("div",X,[t[13]||(t[13]=e("label",{class:"text-xs font-bold text-green-600 uppercase tracking-widest block mb-1"},"Estimasi Biaya",-1)),e("p",Y,l(r.report.price?"Rp "+parseInt(r.report.price).toLocaleString("id-ID"):"Belum ditentukan"),1)])):x("",!0)]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-2"},"Bukti Foto/Video",-1)),m.value.length>0?(s(),o("div",Z,[(s(!0),o(k,null,y(m.value,(a,f)=>(s(),o("a",{key:f,href:`/storage/${a}`,target:"_blank",class:"block aspect-square rounded-lg overflow-hidden border border-gray-200 relative group cursor-pointer"},[B(a)?(s(),o("img",{key:0,src:`/storage/${a}`,class:"w-full h-full object-cover transition duration-300 group-hover:scale-110",alt:"Bukti"},null,8,ee)):(s(),o("div",te,[...t[14]||(t[14]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])),t[15]||(t[15]=e("div",{class:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},[e("span",{class:"bg-white text-xs font-bold px-2 py-1 rounded text-black shadow-sm"},"Buka")],-1))],8,_))),128))])):(s(),o("div",re,[...t[16]||(t[16]=[e("p",{class:"text-sm text-gray-400 italic"},"Tidak ada lampiran foto/video.",-1)])]))]),e("div",null,[r.report.contract_file?(s(),o("a",{key:0,href:r.report.contract_file,target:"_blank",class:"block w-full p-4 bg-blue-50 rounded-xl border border-blue-100 hover:bg-blue-100 transition cursor-pointer group relative z-20"},[...t[18]||(t[18]=[e("label",{class:"text-xs font-bold text-blue-400 uppercase tracking-widest block mb-1 cursor-pointer group-hover:text-blue-500"},"Kontrak Kerja",-1),e("div",{class:"font-bold text-blue-700 flex items-center gap-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})]),g(" Lihat bukti kontrak ")],-1)])],8,oe)):(s(),o("div",se,[...t[19]||(t[19]=[e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-1"},"Kontrak Kerja",-1),e("div",{class:"font-bold text-gray-400 flex items-center gap-2"},"Belum diisi user",-1)])]))]),e("div",null,[r.report.payment_proof?(s(),o("a",{key:0,href:r.report.payment_proof,target:"_blank",class:"block w-full p-4 bg-blue-50 rounded-xl border border-blue-100 hover:bg-blue-100 transition cursor-pointer group relative z-20"},[...t[20]||(t[20]=[e("label",{class:"text-xs font-bold text-blue-400 uppercase tracking-widest block mb-1 cursor-pointer group-hover:text-blue-500"},"Bukti Pembayaran",-1),e("div",{class:"font-bold text-blue-700 flex items-center gap-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})]),g(" Lihat bukti pembayaran ")],-1)])],8,le)):(s(),o("div",ae,[...t[21]||(t[21]=[e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-1"},"Bukti Pembayaran",-1),e("div",{class:"font-bold text-gray-400 flex items-center gap-2"},"Belum diisi user",-1)])]))]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest block mb-2"},"Checklist Kerusakan",-1)),e("div",ne,[(s(!0),o(k,null,y(r.report.damage_types,(a,f)=>(s(),o("span",{key:f,class:"px-3 py-1 rounded-full bg-red-50 text-red-700 text-sm font-medium border border-red-100"},l(a),1))),128)),(p=r.report.damage_types)!=null&&p.length?x("",!0):(s(),o("span",ie,"Tidak ada data checklist."))])])]),r.report.vendor&&r.report.status!=="verification"?(s(),o("div",de,[t[26]||(t[26]=A('<div class="absolute -right-4 -top-4 opacity-5 pointer-events-none"><svg class="w-32 h-32 text-[#BB4D00]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 14l9-5-9-5-9 5 9 5z"></path><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"></path></svg></div><label class="text-xs font-bold text-orange-800 uppercase tracking-widest block mb-3 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-[#BB4D00]"></span> Mitra Pelaksana (Dipilih User) </label>',2)),e("div",ue,[e("div",pe,l(r.report.vendor.nama_mitra.charAt(0)),1),e("div",be,[e("h4",ce,l(r.report.vendor.nama_mitra),1),e("div",ge,[e("div",xe,[t[23]||(t[23]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",null,l(r.report.vendor.no_telepon),1)]),e("div",fe,[t[24]||(t[24]=e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",ke,l(r.report.vendor.alamat||"Alamat tidak tersedia"),1)])])]),t[25]||(t[25]=e("div",{class:"hidden sm:block"},[e("span",{class:"px-3 py-1 bg-green-100 text-green-700 text-[10px] uppercase font-bold rounded-full border border-green-200 tracking-wide"}," Terverifikasi ")],-1))])])):x("",!0),e("div",me,[t[34]||(t[34]=e("h3",{class:"font-bold text-[#BB4D00] text-lg mb-6 uppercase tracking-wide flex items-center gap-2"},[e("span",{class:"w-8 h-[2px] bg-[#BB4D00]"}),g(" Tindakan Admin ")],-1)),r.report.status==="verification"?(s(),o("div",ve,[e("div",ye,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Kategori Kerusakan",-1)),h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>u(i).category=a),class:"w-full rounded-xl border-gray-300 focus:ring-[#BB4D00] focus:border-[#BB4D00]"},[...t[27]||(t[27]=[e("option",{value:"",disabled:""},"Pilih Kategori...",-1),e("option",{value:"Ringan"},"Ringan",-1),e("option",{value:"Sedang"},"Sedang",-1),e("option",{value:"Berat"},"Berat",-1)])],512),[[K,u(i).category]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-xs font-bold text-gray-600 mb-1"},"Input Estimasi Biaya (Rp)",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>u(i).price=a),type:"number",placeholder:"0",class:"w-full rounded-xl border-gray-300 focus:ring-[#BB4D00] focus:border-[#BB4D00]"},null,512),[[T,u(i).price]])])]),e("div",he,[e("button",{onClick:t[2]||(t[2]=a=>c("verify")),disabled:u(i).processing||!u(i).price||!u(i).category,class:"flex-1 bg-[#BB4D00] hover:bg-[#903000] text-white py-3 rounded-xl font-bold transition disabled:opacity-50 shadow-lg shadow-orange-200 disabled:cursor-not-allowed"}," Verifikasi & Kirim Penawaran ",8,we),e("button",{onClick:t[3]||(t[3]=a=>c("cancel")),class:"px-6 py-3 bg-white border border-red-200 text-red-600 rounded-xl font-bold hover:bg-red-50 transition"}," Tolak ")])])):r.report.status==="pending"?(s(),o("div",Be,[t[30]||(t[30]=e("p",{class:"text-sm text-blue-600 mb-4"},"Cek Bukti Bayar dan Kontrak Kerja harus sesuai dengan Harga Fix.",-1)),e("p",De,"Rp "+l(parseInt(u(i).price).toLocaleString("id-ID")),1),e("button",{onClick:t[4]||(t[4]=a=>c("confirm_payment")),class:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold transition shadow-lg shadow-blue-200"}," Konfirmasi Pembayaran Diterima ")])):r.report.status==="process"?(s(),o("div",je,[t[31]||(t[31]=e("h4",{class:"text-green-900 font-bold mb-1"},"Proyek Dalam Pengerjaan",-1)),e("p",Me,"Total Biaya: Rp "+l(parseInt(r.report.price).toLocaleString("id-ID")),1),t[32]||(t[32]=e("p",{class:"text-green-800 mb-4 font-medium text-sm"},"Klik tombol di bawah jika pengerjaan telah selesai sepenuhnya.",-1)),e("button",{onClick:t[5]||(t[5]=a=>c("complete")),class:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold transition shadow-lg shadow-green-200"}," Tandai Pesanan Selesai ")])):(s(),o("div",Se,[r.report.price?(s(),o("p",ze," Total Transaksi: Rp "+l(parseInt(r.report.price).toLocaleString("id-ID")),1)):x("",!0),t[33]||(t[33]=e("p",null,"Laporan selesai. Tidak ada tindakan yang diperlukan.",-1))]))]),t[35]||(t[35]=e("div",{class:"h-20"},null,-1))])])])],64)}}};export{Ae as default};
